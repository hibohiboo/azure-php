var e=Object.defineProperty,a=Object.defineProperties,o=Object.getOwnPropertyDescriptors,l=Object.getOwnPropertySymbols,t=Object.prototype.hasOwnProperty,n=Object.prototype.propertyIsEnumerable,s=(a,o,l)=>o in a?e(a,o,{enumerable:!0,configurable:!0,writable:!0,value:l}):a[o]=l,i=(e,a)=>{for(var o in a||(a={}))t.call(a,o)&&s(e,o,a[o]);if(l)for(var o of l(a))n.call(a,o)&&s(e,o,a[o]);return e},r=(e,l)=>a(e,o(l));import{f as d,r as p,i as u,d as c,s as m,a as g,b as y,c as b,p as v,e as h,g as f,h as U,F as k,j as w,w as V,k as M,o as I,l as x,m as C,n as T,q as S,t as O,u as $,v as D,x as R,P as _}from"./vendor.b3d83f55.js";const j={apiKey:"AIzaSyDHc2n_jZbvUoX_epWTLpRA_Yh0eUseons",authDomain:"trpg-scenario-support-tool.firebaseapp.com",projectId:"trpg-scenario-support-tool"};d.apps.length||d.initializeApp(j);const A=d.firestore(),E=d.auth(),L=d.firestore.FieldValue.serverTimestamp,P=Symbol("authStore"),q=()=>{const e=u(P);if(!e)throw new Error(`${P} is not provided`);return e},N=async(e,a,o)=>(async(e,a,o)=>{const l=A.collection("online-tool-rooms");await Promise.all([l.doc(e).set(r(i({},a),{uid:o,createdAt:L()}))]);const t=(await l.doc(e).get()).data();if(!t)throw new Error("create failed newItem is empty");return r(i({},t),{id:e,createdAt:(n=t.createdAt,JSON.parse(JSON.stringify(n)))});var n})(e,a,o),z=async()=>(async()=>{const e=A.collection("online-tool-rooms"),{id:a}=await e.doc();return a})(),B=async()=>(async()=>{const e=await A.collection("online-tool-rooms").get(),a=[];return e.forEach((e=>{a.push(e.data())})),a})(),F={title:"",roomId:"",tags:"",scenarioTitle:"",scenarioUrl:"",materials:[{name:"",url:""},{name:"",url:""},{name:"",url:""},{name:"",url:""},{name:"",url:""}],displayModal:!1,isUpdate:!1},H=Symbol("roomStore"),J=()=>{const e=u(H);if(!e)throw new Error(`${H} is not provided`);const{state:a}=q();return r(i({},e),{createRoom:async()=>{const{roomId:o,title:l,tags:t,scenarioTitle:n,scenarioUrl:s,materials:i}=e.room,r={roomId:o,title:l,tags:t,scenarioTitle:n,scenarioUrl:s,materials:i};l?(await N(o,r,a.uid),e.closeModal(),location.reload()):alert("タイトルは必須です")},state:a})};var K=c({components:{Dialog:m,Button:g,InputText:y,FileUpload:b},name:"RoomInputDialog",setup:()=>{const{room:e,state:a,createRoom:o,closeModal:l}=J();return{closeModal:l,title:e.isUpdate?"編集":"登録",room:e,state:a,createRoom:o}}});const W=V("data-v-6bc2c36a");v("data-v-6bc2c36a");const X=U("h5",null,"タイトル※必須",-1),Y=U("h5",null,"ルーム画像",-1),Z=U("div",null,"png画像をアップロードしてください。",-1),G=U("p",null,"Drag and drop files to here to upload.",-1),Q=U("h5",null,"タグ",-1),ee=U("div",null,"スペース区切りで複数入力",-1),ae=U("h5",null,"シナリオ名",-1),oe=U("h5",null,"シナリオURL",-1),le=U("h5",null,"利用素材",-1),te={class:"p-float-label"},ne={class:"p-float-label"};h();const se=W(((e,a,o,l,t,n)=>{const s=M("InputText"),i=M("FileUpload"),r=M("Button"),d=M("Dialog");return I(),f(d,{header:e.title,modal:!0,visible:e.room.displayModal,"onUpdate:visible":a[5]||(a[5]=a=>e.room.displayModal=a),breakpoints:{"960px":"75vw","640px":"100vw"},style:{width:"50vw"}},{footer:W((()=>[U(r,{label:"No",icon:"pi pi-times",onClick:e.closeModal,class:"p-button-text"},null,8,["onClick"]),U(r,{label:"登録",icon:"pi pi-check",onClick:e.createRoom,autofocus:""},null,8,["onClick"])])),default:W((()=>[U("div",null,[X,U(s,{type:"text",modelValue:e.room.title,"onUpdate:modelValue":a[1]||(a[1]=a=>e.room.title=a)},null,8,["modelValue"]),Y,Z,U(i,{name:"demo",url:`/roomUpload/${e.state.uid}/${e.room.roomId}`,auto:!0,accept:"image/png","max-file-size":1e6,"choose-label":"画像を選択してください","show-upload-button":!1,"show-cancel-button":!1},{empty:W((()=>[G])),_:1},8,["url"]),Q,ee,U(s,{type:"text",modelValue:e.room.tags,"onUpdate:modelValue":a[2]||(a[2]=a=>e.room.tags=a)},null,8,["modelValue"]),ae,U(s,{type:"text",modelValue:e.room.scenarioTitle,"onUpdate:modelValue":a[3]||(a[3]=a=>e.room.scenarioTitle=a)},null,8,["modelValue"]),oe,U(s,{type:"text",modelValue:e.room.scenarioUrl,"onUpdate:modelValue":a[4]||(a[4]=a=>e.room.scenarioUrl=a)},null,8,["modelValue"]),le,(I(!0),f(k,null,w(e.room.materials,((e,a)=>(I(),f("div",{key:a,class:"flex",style:{"padding-top":"2rem"}},[U("span",te,[U(s,{id:`material-name-${a}`,type:"text",modelValue:e.name,"onUpdate:modelValue":a=>e.name=a},null,8,["id","modelValue","onUpdate:modelValue"]),U("label",{for:`material-name-${a}`},"素材サイト",8,["for"])]),U("span",ne,[U(s,{id:`material-url-${a}`,type:"text",modelValue:e.url,"onUpdate:modelValue":a=>e.url=a},null,8,["id","modelValue","onUpdate:modelValue"]),U("label",{for:`material-url-${a}`},"サイトURL",8,["for"])])])))),128))])])),_:1},8,["header","visible"])}));K.render=se,K.__scopeId="data-v-6bc2c36a";var ie=c({components:{RoomInputDialog:K,Carousel:C,Button:g,Tag:T,InputText:y,Dialog:m},name:"Main",setup:()=>{const e=S(""),{signin:a,state:o}=q(),{openCreateModal:l,openEditModal:t}=J();a();const{rooms:n}=(()=>{const e=p({list:[]});return x((async()=>{e.list=await B()})),{rooms:e}})(),s=S(!1),i=S("");return{openCreateModal:l,openEditModal:t,state:o,responsiveOptions:[{breakpoint:"1024px",numVisible:3,numScroll:3},{breakpoint:"600px",numVisible:2,numScroll:2},{breakpoint:"480px",numVisible:1,numScroll:1}],rooms:n,q:e,displayModal:s,displayImage:i,openDisplayModal:e=>{i.value=e,s.value=!0}}}});const re=V("data-v-192f11c6");v("data-v-192f11c6");const de=U("h1",null,null,-1),pe=U("h5",null,"ココフォリア・ユドナリウムのルーム集",-1),ue=D("絞りこみ: "),ce={class:"product-item"},me={class:"product-item-content"},ge={class:"p-mb-3"},ye={class:"p-mb-1"},be={class:"product-tags"},ve={class:"product-badge status-"},he={class:"product-table"},fe={key:0},Ue=U("th",null,"シナリオ",-1),ke={key:1},we=U("th",null,"利用素材",-1),Ve={key:1},Me={class:"car-buttons p-mt-5"};h();const Ie=re(((e,a,o,l,t,n)=>{const s=M("Button"),i=M("RoomInputDialog"),r=M("InputText"),d=M("Tag"),p=M("Carousel"),u=M("Dialog");return I(),f(k,null,[de,e.state.isLoggedin?(I(),f(s,{key:0,label:"ルームスクリーンショット追加",icon:"pi pi-external-link",onClick:e.openCreateModal},null,8,["onClick"])):O("",!0),U(i),U(p,{value:e.rooms.list.filter((a=>a.tags.includes(e.q))),"num-visible":3,"num-scroll":3,"responsive-options":e.responsiveOptions},{header:re((()=>[pe,U("label",null,[ue,U(r,{modelValue:e.q,"onUpdate:modelValue":a[1]||(a[1]=a=>e.q=a)},null,8,["modelValue"])])])),item:re((a=>[U("div",ce,[U("div",me,[U("div",ge,[U("img",{src:`/uploads/${a.data.uid}/${a.data.roomId}.png`,alt:a.data.name,class:"product-image",onClick:()=>e.openDisplayModal(`/uploads/${a.data.uid}/${a.data.roomId}.png`)},null,8,["src","alt","onClick"])]),U("div",null,[U("h4",ye,$(a.data.title),1),U("div",be,[U("span",ve,[(I(!0),f(k,null,w(a.data.tags.split(" ").filter((e=>!!e)),((a,o)=>(I(),f(d,{key:`tag-${o.toString()}`,value:a,style:{"margin-left":"10px","margin-bottom":"10px"},onClick:()=>e.q=a},null,8,["value","onClick"])))),128))])]),U("div",he,[U("table",null,[a.data.scenarioTitle?(I(),f("tr",fe,[Ue,U("td",null,[a.data.scenarioUrl?(I(),f("a",{key:0,href:a.data.scenarioUrl,target:"_blank"},$(a.data.scenarioTitle),9,["href"])):(I(),f("span",ke,$(a.data.scenarioTitle),1))])])):O("",!0),(I(!0),f(k,null,w(a.data.materials.filter((e=>!!e.name)),((e,a)=>(I(),f("tr",{key:`material-${a.toString()}`},[we,U("td",null,[e.url?(I(),f("a",{key:0,href:e.url,target:"_blank"},$(e.name),9,["href"])):(I(),f("span",Ve,$(e.name),1))])])))),128))])]),U("div",Me,[e.state.uid===a.data.uid?(I(),f(s,{key:0,icon:"pi pi-cog",class:"p-button-help p-button-rounded",label:"編集",onClick:()=>e.openEditModal(a.data)},null,8,["onClick"])):O("",!0)])])])])])),_:1},8,["value","responsive-options"]),U(u,{visible:e.displayModal,"onUpdate:visible":a[2]||(a[2]=a=>e.displayModal=a),"dismissable-mask":!0,modal:!0,"show-header":!1,maximizable:!0,"content-class":"p-0"},{default:re((()=>[U("img",{src:e.displayImage,alt:"preview",style:{width:"100%"}},null,8,["src"])])),_:1},8,["visible"])],64)}));ie.render=Ie,ie.__scopeId="data-v-192f11c6";var xe=c({name:"App",components:{Main:ie}});xe.render=function(e,a,o,l,t,n){const s=M("Main");return I(),f(s,{msg:"Hello Vue 3 + TypeScript + Vite"})},R(xe).use(_).provide(P,(()=>{console.log("init authStore");const e=p({isLoggedin:!1,displayName:"",photoURL:"",uid:""});return E.onAuthStateChanged((a=>(a=>{var o,l;e.isLoggedin=!!a,a&&(e.displayName=null!=(o=a.displayName)?o:"",e.photoURL=null!=(l=a.photoURL)?l:"",e.uid=a.uid)})(a))),{state:e,signin:async()=>{await E.signInAnonymously()},signout:()=>E.signOut()}})()).provide(H,(()=>{const e=p(F);return{room:e,openCreateModal:async()=>{e.title="",e.roomId="",e.scenarioTitle="",e.scenarioUrl="",e.displayModal=!0,e.isUpdate=!1,e.tags="Coc ココフォリア",e.materials=F.materials,e.roomId=await z()},closeModal:()=>{e.displayModal=!1},openEditModal:async a=>{e.title=a.title,e.roomId=a.roomId,e.scenarioTitle=a.scenarioTitle,e.scenarioUrl=a.scenarioUrl,e.tags=a.tags,e.materials=a.materials,e.displayModal=!0,e.isUpdate=!0}}})()).mount("#app");
