var e=Object.defineProperty,a=Object.defineProperties,o=Object.getOwnPropertyDescriptors,l=Object.getOwnPropertySymbols,t=Object.prototype.hasOwnProperty,n=Object.prototype.propertyIsEnumerable,s=(a,o,l)=>o in a?e(a,o,{enumerable:!0,configurable:!0,writable:!0,value:l}):a[o]=l,i=(e,a)=>{for(var o in a||(a={}))t.call(a,o)&&s(e,o,a[o]);if(l)for(var o of l(a))n.call(a,o)&&s(e,o,a[o]);return e},r=(e,l)=>a(e,o(l));import{f as d,r as c,i as p,d as u,s as m,a as y,b as g,c as b,p as v,e as h,g as f,h as U,F as k,j as w,w as V,k as I,o as M,l as x,m as T,n as C,q as R,t as S,u as $,v as O,x as D,y as _,P as E}from"./vendor.f052029b.js";const j={apiKey:"AIzaSyDHc2n_jZbvUoX_epWTLpRA_Yh0eUseons",authDomain:"trpg-scenario-support-tool.firebaseapp.com",projectId:"trpg-scenario-support-tool"};d.apps.length||d.initializeApp(j);const A=d.firestore(),L=d.auth(),N=d.firestore.FieldValue.serverTimestamp,P=Symbol("authStore"),q=()=>{const e=p(P);if(!e)throw new Error(`${P} is not provided`);return e},z=async(e,a,o)=>(async(e,a,o)=>{const l=A.collection("online-tool-rooms");await Promise.all([l.doc(e).set(r(i({},a),{uid:o,createdAt:N()}))]);const t=(await l.doc(e).get()).data();if(!t)throw new Error("create failed newItem is empty");return r(i({},t),{id:e,createdAt:(n=t.createdAt,JSON.parse(JSON.stringify(n)))});var n})(e,a,o),B=async()=>(async()=>{const e=A.collection("online-tool-rooms"),{id:a}=await e.doc();return a})(),F=async()=>(async()=>{const e=await A.collection("online-tool-rooms").get(),a=[];return e.forEach((e=>{a.push(e.data())})),a})(),H={title:"",roomId:"",tags:"",scenarioTitle:"",scenarioUrl:"",materials:[{name:"",url:""},{name:"",url:""},{name:"",url:""},{name:"",url:""},{name:"",url:""}],displayModal:!1,isUpdate:!1},J=Symbol("roomStore"),K=()=>{const e=p(J);if(!e)throw new Error(`${J} is not provided`);const{state:a}=q();return r(i({},e),{createRoom:async()=>{const{roomId:o,title:l,tags:t,scenarioTitle:n,scenarioUrl:s,materials:i}=e.room,r={roomId:o,title:l,tags:t,scenarioTitle:n,scenarioUrl:s,materials:i};l?(await z(o,r,a.uid),e.closeModal(),location.reload()):alert("タイトルは必須です")},state:a})};var W=u({components:{Dialog:m,Button:y,InputText:g,FileUpload:b},name:"RoomInputDialog",setup:()=>{const{room:e,state:a,createRoom:o,closeModal:l}=K();return{closeModal:l,title:e.isUpdate?"編集":"登録",room:e,state:a,createRoom:o}}});const X=V("data-v-6bc2c36a");v("data-v-6bc2c36a");const Y=U("h5",null,"タイトル※必須",-1),Z=U("h5",null,"ルーム画像",-1),G=U("div",null,"png画像をアップロードしてください。",-1),Q=U("p",null,"Drag and drop files to here to upload.",-1),ee=U("h5",null,"タグ",-1),ae=U("div",null,"スペース区切りで複数入力",-1),oe=U("h5",null,"シナリオ名",-1),le=U("h5",null,"シナリオURL",-1),te=U("h5",null,"利用素材",-1),ne={class:"p-float-label"},se={class:"p-float-label"};h();const ie=X(((e,a,o,l,t,n)=>{const s=I("InputText"),i=I("FileUpload"),r=I("Button"),d=I("Dialog");return M(),f(d,{header:e.title,modal:!0,visible:e.room.displayModal,"onUpdate:visible":a[5]||(a[5]=a=>e.room.displayModal=a),breakpoints:{"960px":"75vw","640px":"100vw"},style:{width:"50vw"}},{footer:X((()=>[U(r,{label:"No",icon:"pi pi-times",onClick:e.closeModal,class:"p-button-text"},null,8,["onClick"]),U(r,{label:"登録",icon:"pi pi-check",onClick:e.createRoom,autofocus:""},null,8,["onClick"])])),default:X((()=>[U("div",null,[Y,U(s,{type:"text",modelValue:e.room.title,"onUpdate:modelValue":a[1]||(a[1]=a=>e.room.title=a)},null,8,["modelValue"]),Z,G,U(i,{name:"demo",url:`/roomUpload/${e.state.uid}/${e.room.roomId}`,auto:!0,accept:"image/png","max-file-size":1e6,"choose-label":"画像を選択してください","show-upload-button":!1,"show-cancel-button":!1},{empty:X((()=>[Q])),_:1},8,["url"]),ee,ae,U(s,{type:"text",modelValue:e.room.tags,"onUpdate:modelValue":a[2]||(a[2]=a=>e.room.tags=a)},null,8,["modelValue"]),oe,U(s,{type:"text",modelValue:e.room.scenarioTitle,"onUpdate:modelValue":a[3]||(a[3]=a=>e.room.scenarioTitle=a)},null,8,["modelValue"]),le,U(s,{type:"text",modelValue:e.room.scenarioUrl,"onUpdate:modelValue":a[4]||(a[4]=a=>e.room.scenarioUrl=a)},null,8,["modelValue"]),te,(M(!0),f(k,null,w(e.room.materials,((e,a)=>(M(),f("div",{key:a,class:"flex",style:{"padding-top":"2rem"}},[U("span",ne,[U(s,{id:`material-name-${a}`,type:"text",modelValue:e.name,"onUpdate:modelValue":a=>e.name=a},null,8,["id","modelValue","onUpdate:modelValue"]),U("label",{for:`material-name-${a}`},"素材サイト",8,["for"])]),U("span",se,[U(s,{id:`material-url-${a}`,type:"text",modelValue:e.url,"onUpdate:modelValue":a=>e.url=a},null,8,["id","modelValue","onUpdate:modelValue"]),U("label",{for:`material-url-${a}`},"サイトURL",8,["for"])])])))),128))])])),_:1},8,["header","visible"])}));W.render=ie,W.__scopeId="data-v-6bc2c36a";var re=u({components:{RoomInputDialog:W,Carousel:T,Button:y,Tag:C,InputText:g,Dialog:m},name:"Main",setup:()=>{const e=decodeURI(location.search).replace("?",""),a=R(e||""),{signin:o,state:l}=q(),{openCreateModal:t,openEditModal:n}=K();o();const{rooms:s}=(()=>{const e=c({list:[]});return x((async()=>{e.list=await F()})),{rooms:e}})(),i=R(!1),r=R(""),d=S((()=>s.list.filter((e=>`${e.tags}${e.title}`.includes(a.value)))));return{openCreateModal:t,openEditModal:n,state:l,responsiveOptions:[{breakpoint:"1024px",numVisible:3,numScroll:3},{breakpoint:"600px",numVisible:2,numScroll:2},{breakpoint:"480px",numVisible:1,numScroll:1}],rooms:s,q:a,displayModal:i,displayImage:r,openDisplayModal:e=>{r.value=e,i.value=!0},removeEmptyName:e=>e.filter((e=>!!e.name)),filterdRooms:d,createTags:e=>e.split(" ").filter((e=>!!e))}}});const de=V("data-v-65216cfc");v("data-v-65216cfc");const ce=U("h1",null,null,-1),pe=U("h5",null,"ココフォリア・ユドナリウムのルーム集",-1),ue=D("絞りこみ: "),me={class:"product-item"},ye={class:"product-item-content"},ge={class:"p-mb-3"},be={class:"p-mb-1"},ve={class:"product-tags"},he={class:"product-badge status-"},fe={class:"product-table"},Ue={key:0},ke=U("th",null,"シナリオ",-1),we={key:1},Ve=U("th",null,"利用素材",-1),Ie={key:1},Me={class:"car-buttons p-mt-5"};h();const xe=de(((e,a,o,l,t,n)=>{const s=I("Button"),i=I("RoomInputDialog"),r=I("InputText"),d=I("Tag"),c=I("Carousel"),p=I("Dialog");return M(),f(k,null,[ce,e.state.isLoggedin?(M(),f(s,{key:0,label:"ルームスクリーンショット追加",icon:"pi pi-external-link",onClick:e.openCreateModal},null,8,["onClick"])):$("",!0),U(i),U(c,{value:e.filterdRooms,"num-visible":3,"num-scroll":3,"responsive-options":e.responsiveOptions},{header:de((()=>[pe,U("label",null,[ue,U(r,{modelValue:e.q,"onUpdate:modelValue":a[1]||(a[1]=a=>e.q=a)},null,8,["modelValue"])])])),item:de((a=>[U("div",me,[U("div",ye,[U("div",ge,[U("img",{src:`/uploads/${a.data.uid}/${a.data.roomId}.png`,alt:a.data.name,class:"product-image",onClick:()=>e.openDisplayModal(`/uploads/${a.data.uid}/${a.data.roomId}.png`)},null,8,["src","alt","onClick"])]),U("div",null,[U("h4",be,O(a.data.title),1),U("div",ve,[U("span",he,[(M(!0),f(k,null,w(e.createTags(a.data.tags),((a,o)=>(M(),f(d,{key:`tag-${o.toString()}`,value:a,style:{"margin-left":"10px","margin-bottom":"10px"},onClick:()=>e.q=a},null,8,["value","onClick"])))),128))])]),U("div",fe,[U("table",null,[a.data.scenarioTitle?(M(),f("tr",Ue,[ke,U("td",null,[a.data.scenarioUrl?(M(),f("a",{key:0,href:a.data.scenarioUrl,target:"_blank"},O(a.data.scenarioTitle),9,["href"])):(M(),f("span",we,O(a.data.scenarioTitle),1))])])):$("",!0),(M(!0),f(k,null,w(e.removeEmptyName(a.data.materials),((e,a)=>(M(),f("tr",{key:`material-${a.toString()}`},[Ve,U("td",null,[e.url?(M(),f("a",{key:0,href:e.url,target:"_blank"},O(e.name),9,["href"])):(M(),f("span",Ie,O(e.name),1))])])))),128))])]),U("div",Me,[e.state.uid===a.data.uid?(M(),f(s,{key:0,icon:"pi pi-cog",class:"p-button-help p-button-rounded",label:"編集",onClick:()=>e.openEditModal(a.data)},null,8,["onClick"])):$("",!0)])])])])])),_:1},8,["value","responsive-options"]),U(p,{visible:e.displayModal,"onUpdate:visible":a[2]||(a[2]=a=>e.displayModal=a),"dismissable-mask":!0,modal:!0,"show-header":!1,maximizable:!0,"content-class":"p-0"},{default:de((()=>[U("img",{src:e.displayImage,alt:"preview",style:{width:"100%"}},null,8,["src"])])),_:1},8,["visible"])],64)}));re.render=xe,re.__scopeId="data-v-65216cfc";var Te=u({name:"App",components:{Main:re}});Te.render=function(e,a,o,l,t,n){const s=I("Main");return M(),f(s,{msg:"Hello Vue 3 + TypeScript + Vite"})},_(Te).use(E).provide(P,(()=>{console.log("init authStore");const e=c({isLoggedin:!1,displayName:"",photoURL:"",uid:""});return L.onAuthStateChanged((a=>(a=>{var o,l;e.isLoggedin=!!a,a&&(e.displayName=null!=(o=a.displayName)?o:"",e.photoURL=null!=(l=a.photoURL)?l:"",e.uid=a.uid)})(a))),{state:e,signin:async()=>{await L.signInAnonymously()},signout:()=>L.signOut()}})()).provide(J,(()=>{const e=c(H);return{room:e,openCreateModal:async()=>{e.title="",e.roomId="",e.scenarioTitle="",e.scenarioUrl="",e.displayModal=!0,e.isUpdate=!1,e.tags="Coc ココフォリア",e.materials=H.materials,e.roomId=await B()},closeModal:()=>{e.displayModal=!1},openEditModal:async a=>{e.title=a.title,e.roomId=a.roomId,e.scenarioTitle=a.scenarioTitle,e.scenarioUrl=a.scenarioUrl,e.tags=a.tags,e.materials=a.materials,e.displayModal=!0,e.isUpdate=!0}}})()).mount("#app");
