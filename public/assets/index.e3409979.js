var e=Object.defineProperty,a=Object.defineProperties,o=Object.getOwnPropertyDescriptors,t=Object.getOwnPropertySymbols,l=Object.prototype.hasOwnProperty,n=Object.prototype.propertyIsEnumerable,r=(a,o,t)=>o in a?e(a,o,{enumerable:!0,configurable:!0,writable:!0,value:t}):a[o]=t,s=(e,a)=>{for(var o in a||(a={}))l.call(a,o)&&r(e,o,a[o]);if(t)for(var o of t(a))n.call(a,o)&&r(e,o,a[o]);return e},i=(e,t)=>a(e,o(t));import{f as d,r as u,i as c,d as p,s as m,a as g,b as y,c as b,p as f,e as v,g as h,h as U,F as V,j as k,w,k as I,o as M,l as T,m as x,n as C,q as S,t as O,u as R,v as $,x as _,P as j}from"./vendor.b3d83f55.js";const A={apiKey:"AIzaSyDHc2n_jZbvUoX_epWTLpRA_Yh0eUseons",authDomain:"trpg-scenario-support-tool.firebaseapp.com",projectId:"trpg-scenario-support-tool"};d.apps.length||d.initializeApp(A);const D=d.firestore(),E=d.auth(),L=d.firestore.FieldValue.serverTimestamp,q=Symbol("authStore"),P=()=>{const e=c(q);if(!e)throw new Error(`${q} is not provided`);return e},N=async(e,a,o)=>(async(e,a,o)=>{const t=D.collection("online-tool-rooms");await Promise.all([t.doc(e).set(i(s({},a),{uid:o,createdAt:L()}))]);const l=(await t.doc(e).get()).data();if(!l)throw new Error("create failed newItem is empty");return i(s({},l),{id:e,createdAt:(n=l.createdAt,JSON.parse(JSON.stringify(n)))});var n})(e,a,o),B=async()=>(async()=>{const e=D.collection("online-tool-rooms"),{id:a}=await e.doc();return a})(),F=async()=>(async()=>{const e=await D.collection("online-tool-rooms").get(),a=[];return e.forEach((e=>{a.push(e.data())})),a})(),z={title:"",roomId:"",tags:"",scenarioTitle:"",scenarioUrl:"",materials:[{name:"",url:""},{name:"",url:""},{name:"",url:""},{name:"",url:""},{name:"",url:""}],displayModal:!1,isUpdate:!1},H=Symbol("roomStore"),J=()=>{const e=c(H);if(!e)throw new Error(`${H} is not provided`);const{state:a}=P();return i(s({},e),{createRoom:async()=>{const{roomId:o,title:t,tags:l,scenarioTitle:n,scenarioUrl:r,materials:s}=e.room,i={roomId:o,title:t,tags:l,scenarioTitle:n,scenarioUrl:r,materials:s};t?(await N(o,i,a.uid),e.closeModal(),location.reload()):alert("タイトルは必須です")},state:a})};var K=p({components:{Dialog:m,Button:g,InputText:y,FileUpload:b},name:"RoomInputDialog",setup:()=>{const{room:e,state:a,createRoom:o,closeModal:t}=J();return{closeModal:t,title:e.isUpdate?"編集":"登録",room:e,state:a,createRoom:o}}});const W=w("data-v-1ff49b0c");f("data-v-1ff49b0c");const X=U("h5",null,"タイトル※必須",-1),Y=U("h5",null,"ルーム画像",-1),Z=U("div",null,"png画像をアップロードしてください。",-1),G=U("p",null,"Drag and drop files to here to upload.",-1),Q=U("h5",null,"タグ",-1),ee=U("div",null,"スペース区切りで複数入力",-1),ae=U("h5",null,"シナリオ名",-1),oe=U("h5",null,"シナリオURL",-1),te=U("h5",null,"利用素材",-1),le={class:"p-float-label"},ne={class:"p-float-label"};v();const re=W(((e,a,o,t,l,n)=>{const r=I("InputText"),s=I("FileUpload"),i=I("Button"),d=I("Dialog");return M(),h(d,{header:e.title,visible:e.room.displayModal,"onUpdate:visible":a[5]||(a[5]=a=>e.room.displayModal=a),style:{width:"50vw"}},{footer:W((()=>[U(i,{label:"No",icon:"pi pi-times",onClick:e.closeModal,class:"p-button-text"},null,8,["onClick"]),U(i,{label:"登録",icon:"pi pi-check",onClick:e.createRoom,autofocus:""},null,8,["onClick"])])),default:W((()=>[U("div",null,[X,U(r,{type:"text",modelValue:e.room.title,"onUpdate:modelValue":a[1]||(a[1]=a=>e.room.title=a)},null,8,["modelValue"]),Y,Z,U(s,{name:"demo",url:`/roomUpload/${e.state.uid}/${e.room.roomId}`,auto:!0,accept:"image/png","max-file-size":1e6,"choose-label":"画像を選択してください","show-upload-button":!1,"show-cancel-button":!1},{empty:W((()=>[G])),_:1},8,["url"]),Q,ee,U(r,{type:"text",modelValue:e.room.tags,"onUpdate:modelValue":a[2]||(a[2]=a=>e.room.tags=a)},null,8,["modelValue"]),ae,U(r,{type:"text",modelValue:e.room.scenarioTitle,"onUpdate:modelValue":a[3]||(a[3]=a=>e.room.scenarioTitle=a)},null,8,["modelValue"]),oe,U(r,{type:"text",modelValue:e.room.scenarioUrl,"onUpdate:modelValue":a[4]||(a[4]=a=>e.room.scenarioUrl=a)},null,8,["modelValue"]),te,(M(!0),h(V,null,k(e.room.materials,((e,a)=>(M(),h("div",{key:a,class:"flex",style:{"padding-top":"2rem"}},[U("span",le,[U(r,{id:`material-name-${a}`,type:"text",modelValue:e.name,"onUpdate:modelValue":a=>e.name=a},null,8,["id","modelValue","onUpdate:modelValue"]),U("label",{for:`material-name-${a}`},"素材サイト",8,["for"])]),U("span",ne,[U(r,{id:`material-url-${a}`,type:"text",modelValue:e.url,"onUpdate:modelValue":a=>e.url=a},null,8,["id","modelValue","onUpdate:modelValue"]),U("label",{for:`material-url-${a}`},"サイトURL",8,["for"])])])))),128))])])),_:1},8,["header","visible"])}));K.render=re,K.__scopeId="data-v-1ff49b0c";var se=p({components:{RoomInputDialog:K,Carousel:x,Button:g,Tag:C,InputText:y},name:"Main",props:{msg:{type:String,required:!0}},setup:()=>{const e=S(0),a=S(""),{signin:o,state:t}=P(),{openCreateModal:l,openEditModal:n}=J();o();const{rooms:r}=(()=>{const e=u({list:[]});return T((async()=>{e.list=await F()})),{rooms:e}})();return{count:e,openCreateModal:l,openEditModal:n,state:t,responsiveOptions:[{breakpoint:"1024px",numVisible:3,numScroll:3},{breakpoint:"600px",numVisible:2,numScroll:2},{breakpoint:"480px",numVisible:1,numScroll:1}],rooms:r,q:a}}});const ie=w("data-v-5d30f242");f("data-v-5d30f242");const de=U("h1",null,null,-1),ue=U("h5",null,"ココフォリア・ユドナリウムのルーム集",-1),ce=$("絞りこみ: "),pe={class:"product-item"},me={class:"product-item-content"},ge={class:"p-mb-3"},ye={class:"p-mb-1"},be={class:"product-tags"},fe=$(" タグ "),ve={class:"product-badge status-"},he={class:"product-table"},Ue={key:0},Ve=U("th",null,"シナリオ",-1),ke={key:1},we=U("th",null,"利用素材",-1),Ie={key:1},Me={class:"car-buttons p-mt-5"};v();const Te=ie(((e,a,o,t,l,n)=>{const r=I("Button"),s=I("RoomInputDialog"),i=I("InputText"),d=I("Tag"),u=I("Carousel");return M(),h(V,null,[de,e.state.isLoggedin?(M(),h(r,{key:0,label:"ルームスクリーンショット追加",icon:"pi pi-external-link",onClick:e.openCreateModal},null,8,["onClick"])):O("",!0),U(s),U(u,{value:e.rooms.list.filter((a=>a.tags.includes(e.q))),"num-visible":3,"num-scroll":3,"responsive-options":e.responsiveOptions},{header:ie((()=>[ue,U("label",null,[ce,U(i,{modelValue:e.q,"onUpdate:modelValue":a[1]||(a[1]=a=>e.q=a)},null,8,["modelValue"])])])),item:ie((a=>[U("div",pe,[U("div",me,[U("div",ge,[U("img",{src:`/uploads/${a.data.uid}/${a.data.roomId}.png`,alt:a.data.name,class:"product-image"},null,8,["src","alt"])]),U("div",null,[U("h4",ye,R(a.data.title),1),U("div",be,[fe,U("span",ve,[(M(!0),h(V,null,k(a.data.tags.split(" ").filter((e=>!!e)),((a,o)=>(M(),h(d,{key:`tag-${o.toString()}`,value:a,style:{"margin-left":"10px"},onClick:()=>e.q=a},null,8,["value","onClick"])))),128))])]),U("div",he,[U("table",null,[a.data.scenarioTitle?(M(),h("tr",Ue,[Ve,U("td",null,[a.data.scenarioUrl?(M(),h("a",{key:0,href:a.data.scenarioUrl,target:"_blank"},R(a.data.scenarioTitle),9,["href"])):(M(),h("span",ke,R(a.data.scenarioTitle),1))])])):O("",!0),(M(!0),h(V,null,k(a.data.materials.filter((e=>!!e.name)),((e,a)=>(M(),h("tr",{key:`material-${a.toString()}`},[we,U("td",null,[e.url?(M(),h("a",{key:0,href:e.url,target:"_blank"},R(e.name),9,["href"])):(M(),h("span",Ie,R(e.name),1))])])))),128))])]),U("div",Me,[e.state.uid===a.data.uid?(M(),h(r,{key:0,icon:"pi pi-cog",class:"p-button-help p-button-rounded",label:"編集",onClick:()=>e.openEditModal(a.data)},null,8,["onClick"])):O("",!0)])])])])])),_:1},8,["value","responsive-options"])],64)}));se.render=Te,se.__scopeId="data-v-5d30f242";var xe=p({name:"App",components:{Main:se}});xe.render=function(e,a,o,t,l,n){const r=I("Main");return M(),h(r,{msg:"Hello Vue 3 + TypeScript + Vite"})},_(xe).use(j).provide(q,(()=>{console.log("init authStore");const e=u({isLoggedin:!1,displayName:"",photoURL:"",uid:""});return E.onAuthStateChanged((a=>(a=>{var o,t;e.isLoggedin=!!a,a&&(e.displayName=null!=(o=a.displayName)?o:"",e.photoURL=null!=(t=a.photoURL)?t:"",e.uid=a.uid)})(a))),{state:e,signin:async()=>{await E.signInAnonymously()},signout:()=>E.signOut()}})()).provide(H,(()=>{const e=u(z);return{room:e,openCreateModal:async()=>{e.title="",e.roomId="",e.scenarioTitle="",e.scenarioUrl="",e.displayModal=!0,e.isUpdate=!1,e.tags="Coc ココフォリア",e.materials=z.materials,e.roomId=await B()},closeModal:()=>{e.displayModal=!1},openEditModal:async a=>{e.title=a.title,e.roomId=a.roomId,e.scenarioTitle=a.scenarioTitle,e.scenarioUrl=a.scenarioUrl,e.tags=a.tags,e.materials=a.materials,e.displayModal=!0,e.isUpdate=!0}}})()).mount("#app");
